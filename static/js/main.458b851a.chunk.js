(this["webpackJsonpreact-typescript-starter-pack"]=this["webpackJsonpreact-typescript-starter-pack"]||[]).push([[0],{177:function(e,t,n){},187:function(e,t,n){},188:function(e,t,n){},189:function(e,t,n){"use strict";n.r(t);var c=n(0),r=n.n(c),a=n(49),i=n.n(a),o=n(55),s=n(37),u=n(64),l=n(1),d=n.n(l),j=n(6),f=n(11),O=n(262),b=n(236),p=n(263),h=n(104),m=n(264),x=n(258),v=n(144),g=n(255),E=n(248),y=n(253),C=n(140),I=n.n(C),w=n(113),D=n.n(w),A=n(141),R=n.n(A),k=n(22),S=n(53),T=n(57),_=Object(T.c)({name:"user",initialState:{user:null,credential:null,auth:null},reducers:{setUser:function(e,t){var n=t.payload.user,c=u.a.credentialFromResult(t.payload);e.user=n,e.credential=c},setAuth:function(e,t){e.auth=t.payload},setDirectlyUser:function(e,t){e.user=t.payload},removeUser:function(e){e.user=null,e.credential=null}}}),L=_.actions,N=(L.setUser,L.removeUser),H=L.setDirectlyUser,M=L.setAuth,P=function(e){return e.user.user},G=function(e){return e.user.credential},U=function(e){return e.user.auth},V=_.reducer,W=function(){var e=Object(s.c)(P);return{isAuth:!!e,user:e,credential:Object(s.c)(G),auth:Object(s.c)(U)}},z=function(){return Object(s.b)()},F=s.c,Y=n(252),B=n(130),Q=n.n(B),J=n(4),K=Object(c.memo)((function(){var e=Object(s.c)(U),t=Object(k.g)(),n=Object(c.useCallback)(Object(j.a)(d.a.mark((function n(){var c;return d.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,c=new u.a,n.next=4,Object(u.c)(e,c);case 4:t(Je.HOME),n.next=11;break;case 7:throw n.prev=7,n.t0=n.catch(0),console.log(n.t0),new Error("some issue with sing in with google");case 11:case"end":return n.stop()}}),n,null,[[0,7]])}))),[e,t]);return Object(J.jsx)(b.a,{children:Object(J.jsx)(Y.a,{alignItems:"center",justifyContent:"center",display:"flex",style:{height:window.innerHeight-64},children:Object(J.jsx)(Q.a,{onClick:n})})})})),X=n(20),q=n(249),Z=n(69),$=n(132),ee=n.n($),te=n(131),ne=Object(te.a)({apiKey:"AIzaSyAXfGe3IcD2w0YbDN7wLLQ6ElaSTcfsYkQ",authDomain:"chat-react-eaa0f.firebaseapp.com",projectId:"chat-react-eaa0f",storageBucket:"chat-react-eaa0f.appspot.com",messagingSenderId:"254749271243",appId:"1:254749271243:web:17ecfe4efe5f947fd1674e",measurementId:"G-0RNETXFQ7W"}),ce={app:ne,database:Object(Z.a)(ne,"https://chat-react-eaa0f-default-rtdb.europe-west1.firebasedatabase.app")},re=Object(T.c)({name:"firebase",initialState:ce,reducers:{}}),ae=function(e){return e.firebaseApp.app},ie=function(e){return e.firebaseApp.database},oe=re.reducer,se=(n(177),Object(c.memo)((function(){var e,t=W().user,n=Object(s.c)(ie),r=Object(Z.d)(n,"posts"),a=Object(c.useState)([]),i=Object(f.a)(a,2),o=i[0],u=i[1],l=Object(c.useRef)(null),d=Object(c.useState)(""),j=Object(f.a)(d,2),O=j[0],p=j[1],h=Object(c.useCallback)((function(){if(O.trim()){var e=Object(Z.c)(r);Object(Z.e)(e,{uID:null===t||void 0===t?void 0:t.uid,username:null===t||void 0===t?void 0:t.displayName,email:null===t||void 0===t?void 0:t.email,profile_picture:null===t||void 0===t?void 0:t.photoURL,message:O}),p("")}}),[r,O]);return Object(c.useEffect)((function(){e=Object(Z.b)(r,(function(e){u((function(t){return[].concat(Object(X.a)(t),[e.val()])}))}))}),[]),Object(c.useEffect)((function(){l.current.scrollTop=l.current.scrollHeight}),[o]),Object(c.useEffect)((function(){return function(){e()}}),[]),Object(J.jsx)(b.a,{children:Object(J.jsxs)(Y.a,{container:!0,alignItems:"center",justifyContent:"center",direction:"column",display:"flex",style:{height:window.innerHeight-70,maxHeight:window.innerHeight-70},children:[Object(J.jsx)("div",{className:"messagesBox",ref:l,children:o.map((function(e){return(null===t||void 0===t?void 0:t.uid)===e.uID?Object(J.jsxs)("div",{style:{display:"flex",gridGap:"1px",justifyContent:"end",padding:"0 20px"},children:[Object(J.jsx)("div",{className:"message-cloud message-cloud--from-me",children:Object(J.jsx)("div",{children:e.message})}),Object(J.jsx)("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"flex-end"},children:Object(J.jsx)(y.a,{src:e.profile_picture})})]},Object(S.a)()):Object(J.jsxs)("div",{style:{display:"flex",gridGap:"1px",justifyContent:"start",padding:"0 20px"},children:[Object(J.jsx)("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"flex-end"},children:Object(J.jsx)(y.a,{src:e.profile_picture})}),Object(J.jsxs)("div",{className:"message-cloud message-cloud--from-them",children:[Object(J.jsx)("div",{children:e.username}),Object(J.jsx)("div",{children:e.message})]})]},Object(S.a)())}))}),Object(J.jsx)(Y.a,{container:!0,alignItems:"flex-end",direction:"column",style:{width:"90%"},children:Object(J.jsx)(q.a,{style:{marginTop:10},fullWidth:!0,maxRows:3,multiline:!0,size:"small",InputProps:{endAdornment:Object(J.jsx)(x.a,{color:"primary","aria-label":"upload picture",component:"label",onClick:h,size:"small",children:Object(J.jsx)(ee.a,{})})},id:"outlined-basic",label:"Enter message",variant:"outlined",value:O,onChange:function(e){var t=e.target;p(t.value)},onKeyDown:function(e){"Enter"!==e.code&&"NumpadEnter"!==e.code||!e.ctrlKey?"Enter"!==e.code&&"NumpadEnter"!==e.code||e.ctrlKey||(e.preventDefault(),h()):p((function(e){return"".concat(e,"\n")}))}})})]})})}))),ue=Object(c.memo)((function(){return Object(J.jsx)("div",{children:Object(J.jsx)("h1",{children:"HOME PAGE"})})})),le=n(32),de=n.n(le),je=n(142),fe=Object(je.a)("https://react-online-chat-sign-server.herokuapp.com",{"force new connection":!0,reconnetionAttempts:"Infinity",timeout:15e3,transports:["websocket"]}),Oe={socket:fe,rooms:[]},be=Object(T.b)("videochat/updateRooms",function(){var e=Object(j.a)(d.a.mark((function e(t,n){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:(0,n.dispatch)(he(t));case 2:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()),pe=Object(T.c)({name:"videochat",initialState:Oe,reducers:{setRooms:function(e,t){e.rooms=t.payload}}}),he=pe.actions.setRooms,me=function(e){return e.videochat.rooms},xe=function(e){return e.videochat.socket},ve=pe.reducer,ge=n(257),Ee=n(259),ye=n(260),Ce=n(245),Ie=n(246),we=n(254),De=n(135),Ae=n.n(De),Re=n(136),ke=n.n(Re),Se=n(137),Te=n.n(Se),_e=n(251),Le=Object(c.memo)((function(e){var t=e.rooms,n=Object(k.g)(),r=Object(c.useCallback)((function(){n("".concat(Je.VIDEOCHAT,"/").concat(Object(_e.a)()))}),[]),a=Object(c.useCallback)((function(e){n("".concat(Je.VIDEOCHAT,"/").concat(e))}),[]);return Object(J.jsx)(b.a,{children:Object(J.jsxs)(Y.a,{container:!0,alignItems:"center",justifyContent:"center",direction:"column",display:"flex",style:{height:window.innerHeight-68},children:[Object(J.jsx)(ge.a,{sx:{width:"100%",overflowY:"auto",height:"70vh",padding:0},component:"nav","aria-labelledby":"avalible-rooms",subheader:Object(J.jsx)(Ee.a,{component:"div",id:"nested-list-subheader",children:"Avalible rooms"}),children:t.map((function(e){return Object(J.jsx)(E.a,{title:"Click to join room",children:Object(J.jsxs)(ye.a,{onClick:function(){a(e)},children:[Object(J.jsx)(Ce.a,{children:Object(J.jsx)(Ae.a,{})}),Object(J.jsx)(Ie.a,{sx:{wordWrap:"break-word"},primary:e}),Object(J.jsx)(Ce.a,{children:Object(J.jsx)(ke.a,{})})]})},e)}))}),Object(J.jsx)(we.a,{variant:"outlined",endIcon:Object(J.jsx)(Te.a,{}),onClick:r,children:"Create room"})]})})})),Ne=Object(c.memo)((function(){var e=F(me),t=F(xe),n=z();return Object(c.useEffect)((function(){t.on(de.a.SHARE_ROOMS,(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.rooms,c=void 0===t?[]:t;n(be(c))})),fe.emit(de.a.REQUEST_ROOMS)}),[]),Object(J.jsx)(Le,{rooms:e})})),He=r.a.memo((function(){return Object(J.jsx)("div",{children:Object(J.jsx)("h1",{children:"NOT FOUND PAGE"})})})),Me=n(247),Pe=n(2),Ge=n(138),Ue=n.n(Ge),Ve="LOCAL_VIDEO",We=function(e){var t=function(e){var t=Object(c.useState)(e),n=Object(f.a)(t,2),r=n[0],a=n[1],i=Object(c.useRef)((function(e){return e})),o=Object(c.useCallback)((function(e,t){i.current=t,a((function(t){return"function"===typeof e?e(t):e}))}),[]);return Object(c.useEffect)((function(){i.current&&i.current(r)}),[r]),[r,o]}([]),n=Object(f.a)(t,2),r=n[0],a=n[1],i=Object(c.useCallback)((function(e,t){a((function(t){return t.includes(e)?t:[].concat(Object(X.a)(t),[e])}),t)}),[r,a]),o=Object(c.useRef)({}),s=Object(c.useRef)(null),u=Object(c.useRef)(Object(Pe.a)({},Ve,null));return Object(c.useEffect)((function(){function e(){return(e=Object(j.a)(d.a.mark((function e(t){var n,c,r,a,l,O;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.peerID,c=t.createOffer,!(n in o.current)){e.next=3;break}return e.abrupt("return",console.warn("Already connected to peer ".concat(n)));case 3:if(r=Ue()(),console.log(r),o.current[n]=new RTCPeerConnection({iceServers:r}),console.log("peer connection was created"),o.current[n].onicecandidate=function(e){e.candidate&&fe.emit(de.a.RELAY_ICE,{peerID:n,iceCandidate:e.candidate})},a=0,o.current[n].ontrack=function(){var e=Object(j.a)(d.a.mark((function e(t){var c,r;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:c=Object(f.a)(t.streams,1),r=c[0],2===(a+=1)&&(a=0,i(n,(function(){var e=u.current[n];e&&(e.srcObject=r)})));case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),(l=s.current)&&l.getTracks().forEach((function(e){o.current[n].addTrack(e,l)})),!c){e.next=19;break}return e.next=15,o.current[n].createOffer();case 15:return O=e.sent,e.next=18,o.current[n].setLocalDescription(O);case 18:fe.emit(de.a.RELAY_SDP,{peerID:n,sessionDescription:O});case 19:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return fe.on(de.a.ADD_PEER,(function(t){return e.apply(this,arguments)})),function(){fe.off(de.a.ADD_PEER)}}),[]),Object(c.useEffect)((function(){return fe.on(de.a.REMOVE_PEER,(function(e){var t=e.peerID;o.current[t]&&o.current[t].close(),delete o.current[t],delete u.current[t],a((function(e){return e.filter((function(e){return e!==t}))}))})),function(){fe.off(de.a.REMOVE_PEER)}}),[]),Object(c.useEffect)((function(){function e(){return(e=Object(j.a)(d.a.mark((function e(t){var n,c,r;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.peerID,c=t.sessionDescription,console.log("session description"),e.next=4,o.current[n].setRemoteDescription(new RTCSessionDescription(c));case 4:if("offer"!==c.type){e.next=11;break}return e.next=7,o.current[n].createAnswer();case 7:return r=e.sent,e.next=10,o.current[n].setLocalDescription(r);case 10:fe.emit(de.a.RELAY_SDP,{peerID:n,sessionDescription:r});case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return fe.on(de.a.SESSION_DESCRIPTION,(function(t){return e.apply(this,arguments)})),function(){fe.off(de.a.SESSION_DESCRIPTION)}}),[]),Object(c.useEffect)((function(){return fe.on(de.a.ICE_CANDIDATE,(function(e){var t=e.peerID,n=e.iceCandidate;console.log("ice candidate"),o.current[t].addIceCandidate(new RTCIceCandidate(n))})),function(){fe.off(de.a.ICE_CANDIDATE)}}),[]),Object(c.useEffect)((function(){function t(){return(t=Object(j.a)(d.a.mark((function e(){var t;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,navigator.mediaDevices.getUserMedia({audio:!0,video:{width:{min:1024,ideal:1280,max:1920},height:{min:576,ideal:720,max:1080}}});case 2:t=e.sent,s.current=t,i(Ve,(function(){var e=u.current.LOCAL_VIDEO;e&&s.current&&(e.volume=0,e.srcObject=s.current)}));case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return function(){return t.apply(this,arguments)}().then((function(){return fe.emit(de.a.JOIN,{room:e})})).catch((function(e){return console.error("Error getting userMedia",e)})),function(){s&&s.current&&(s.current.getTracks().forEach((function(e){e.stop()})),fe.emit(de.a.LEAVE))}}),[e]),{clients:r,provideMediaRef:Object(c.useCallback)((function(e,t){u.current[e]=t}),[])}},ze=n(59),Fe=n(261),Ye=n(139),Be=n.n(Ye),Qe=Object(c.memo)((function(e){var t=e.clientID,n=e.provideMediaRef,r=e.containerLayoutStyle,a=Object(c.useState)(!1),i=Object(f.a)(a,2),o=i[0],s=i[1];return Object(J.jsx)("div",{style:{display:"flex",justifyContent:"center",alignItems:"center"},children:Object(J.jsxs)("div",{style:Object(ze.a)(Object(ze.a)({},r),{},{borderRadius:"20px",overflow:"hidden",position:"relative"}),children:[Object(J.jsx)("video",{ref:function(e){n(t,e)},width:"100%",height:"100%",autoPlay:!0,playsInline:!0,muted:t===Ve||o}),!(t===Ve)&&Object(J.jsx)(Fe.a,{value:"left",selected:o,onChange:function(){s((function(e){return!e}))},style:{width:10,height:10,position:"absolute",bottom:0,left:"calc(50% - 5px)",marginBottom:5},children:Object(J.jsx)(Be.a,{})})]})})}));var Je,Ke=Object(c.memo)((function(){var e=Object(k.h)().id||"",t=We(e),n=t.clients,c=t.provideMediaRef,r=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=Array.from({length:e}).reduce((function(e,t,n,c){return n%2===0&&e.push(c.slice(n,n+2)),e}),[]),n=t.length,c="".concat(100/n,"%");return t.map((function(e,t,n){return t===n.length-1&&1===e.length?[{width:"100%",height:c}]:e.map((function(){return{width:"50%",height:c}}))})).flat()}(n.length);return Object(J.jsxs)(Me.a,{children:[Object(J.jsx)("h1",{children:"Videochat room"}),Object(J.jsx)("h1",{children:e}),Object(J.jsx)("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",flexWrap:"wrap",height:"80vh"},children:n.map((function(e,t){return Object(J.jsx)(Qe,{clientID:e,provideMediaRef:c,containerLayoutStyle:r[t]},e)}))})]})}));!function(e){e.LOGIN="/login",e.VIDEOCHAT="/videochat",e.VIDEOCHAT_ROOM="/videochat/:id",e.CHAT="/chat",e.HOME="/home",e.ROOT="/",e.WRONG="*"}(Je||(Je={}));var Xe,qe,Ze=[{path:Je.ROOT,component:Object(J.jsx)(k.a,{to:Je.HOME,replace:!0})},{path:Je.HOME,component:Object(J.jsx)(ue,{})},{path:Je.LOGIN,component:Object(J.jsx)(K,{})},{path:Je.WRONG,component:Object(J.jsx)(He,{})}],$e=Ze.concat([{path:Je.CHAT,component:Object(J.jsx)(se,{})},{path:Je.VIDEOCHAT,component:Object(J.jsx)(Ne,{})},{path:Je.VIDEOCHAT_ROOM,component:Object(J.jsx)(Ke,{})}]);!function(e){e.CHAT="Chat",e.HOME="Home",e.VIDEOCHAT="Videochat"}(Xe||(Xe={})),function(e){e.PROFILE="Profile",e.LOGOUT="Logout"}(qe||(qe={}));var et=Object(c.memo)((function(){var e=W(),t=e.isAuth,n=e.user,c=e.auth,a=z(),i=Object(k.g)(),s=r.a.useState(null),u=Object(f.a)(s,2),l=u[0],C=u[1],w=r.a.useState(null),A=Object(f.a)(w,2),T=A[0],_=A[1],L=function(e){e&&i(e.toLowerCase()),C(null)},H=function(){var e=Object(j.a)(d.a.mark((function e(t){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=t,e.next=e.t0===qe.LOGOUT?3:8;break;case 3:if(!c){e.next=7;break}return e.next=6,c.signOut();case 6:a(N());case 7:case 8:return e.abrupt("break",9);case 9:_(null);case 10:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return Object(J.jsx)("header",{children:Object(J.jsx)(O.a,{position:"static",children:Object(J.jsx)(b.a,{maxWidth:"xl",children:Object(J.jsxs)(p.a,{disableGutters:!0,children:[Object(J.jsx)(D.a,{sx:{display:{xs:"none",md:"flex"},mr:1}}),Object(J.jsx)(h.a,{variant:"h6",noWrap:!0,sx:{mr:2,display:{xs:"none",md:"flex"},fontFamily:"monospace",flexGrow:1,fontWeight:700,letterSpacing:".3rem",color:"inherit",textDecoration:"none"},children:"Chat"}),Object(J.jsxs)(m.a,{sx:{flexGrow:1,display:{xs:"flex",md:"none"}},children:[Object(J.jsx)(x.a,{size:"large","aria-label":"account of current user","aria-controls":"menu-appbar","aria-haspopup":"true",onClick:function(e){C(e.currentTarget)},color:"inherit",children:Object(J.jsx)(I.a,{})}),Object(J.jsx)(v.a,{id:"menu-appbar",anchorEl:l,anchorOrigin:{vertical:"bottom",horizontal:"left"},keepMounted:!0,transformOrigin:{vertical:"top",horizontal:"left"},open:Boolean(l),onClose:function(){L(null)},sx:{display:{xs:"block",md:"none"}},children:Object.values(Xe).map((function(e){return Object(J.jsx)(g.a,{onClick:function(){L(e)},children:Object(J.jsx)(h.a,{textAlign:"center",children:e})},Object(S.a)())}))})]}),Object(J.jsx)(D.a,{sx:{display:{xs:"flex",md:"none"},mr:1}}),Object(J.jsx)(h.a,{variant:"h5",noWrap:!0,sx:{mr:2,display:{xs:"flex",md:"none"},flexGrow:1,fontFamily:"monospace",fontWeight:700,letterSpacing:".3rem",color:"inherit",textDecoration:"none"},children:"Chat"}),Object(J.jsx)(m.a,{sx:{flexGrow:1,display:{xs:"none",md:"flex"}},children:Object.values(Xe).map((function(e){return Object(J.jsx)(g.a,{onClick:function(){L(e)},children:Object(J.jsx)(h.a,{textAlign:"center",children:e})},Object(S.a)())}))}),Object(J.jsx)(m.a,{sx:{flexGrow:0},children:t&&n?Object(J.jsxs)(J.Fragment,{children:[Object(J.jsx)(E.a,{title:"Open settings",children:Object(J.jsx)(x.a,{onClick:function(e){_(e.currentTarget)},sx:{p:0},children:Object(J.jsx)(y.a,{alt:"User Avatar",src:n.photoURL||""})})}),Object(J.jsx)(v.a,{sx:{mt:"45px"},id:"menu-appbar",anchorEl:T,anchorOrigin:{vertical:"top",horizontal:"right"},keepMounted:!0,transformOrigin:{vertical:"top",horizontal:"right"},open:Boolean(T),onClose:H,children:Object.values(qe).map((function(e){return Object(J.jsx)(g.a,{onClick:function(){H(e)},children:Object(J.jsx)(h.a,{textAlign:"center",children:e})},Object(S.a)())}))})]}):Object(J.jsx)(o.b,{to:Je.LOGIN,style:function(){return{color:"#fff"}},children:Object(J.jsx)(R.a,{})})})]})})})})})),tt=Object(c.memo)((function(){return W().isAuth?Object(J.jsx)(k.d,{children:$e.map((function(e){var t=e.path,n=e.component;return Object(J.jsx)(k.b,{path:t,element:n},Object(S.a)())}))}):Object(J.jsx)(k.d,{children:Ze.map((function(e){var t=e.path,n=e.component;return Object(J.jsx)(k.b,{path:t,element:n},Object(S.a)())}))})})),nt=(n(187),Object(c.memo)((function(){var e=z(),t=Object(s.c)(ae),n=Object(u.b)(t);e(M(n));var r=n.onAuthStateChanged((function(t){t&&e(H(t))}));return Object(c.useEffect)((function(){return function(){r()}}),[]),Object(J.jsxs)(J.Fragment,{children:[Object(J.jsx)(et,{}),Object(J.jsx)(tt,{})]})}))),ct=Object(T.a)({reducer:{user:V,firebaseApp:oe,videochat:ve},middleware:function(e){return e({serializableCheck:{ignoredActions:["user/setUser","user/setDirectlyUser","user/setAuth"],ignoredPaths:["user.auth","user.user","user.credential","firebaseApp.app","firebaseApp.database","videochat.socket"]}})}});n(188);i.a.render(Object(J.jsx)(o.a,{children:Object(J.jsx)(s.a,{store:ct,children:Object(J.jsx)(r.a.StrictMode,{children:Object(J.jsx)(nt,{})})})}),document.getElementById("root"))},32:function(e,t){e.exports={JOIN:"join",LEAVE:"leave",SHARE_ROOMS:"share-rooms",REQUEST_ROOMS:"request-rooms",ADD_PEER:"add-peer",REMOVE_PEER:"remove-peer",RELAY_SDP:"relay-sdp",RELAY_ICE:"relay-ice",ICE_CANDIDATE:"ice-candidate",SESSION_DESCRIPTION:"session-desription",USER_MUTED:"user-muted"}}},[[189,1,2]]]);
//# sourceMappingURL=main.458b851a.chunk.js.map